<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rent Manager Pro - Akash Sheikh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input { min-height: 45px; font-size: 16px !important; padding: 8px !important; }
        th, td { min-width: 120px; }
        .send-btn { min-width: 60px; height: 40px; }
        .status-full { background-color: #d1fae5 !important; } 
        .status-partial { background-color: #fef3c7 !important; } 
        .status-due { background-color: #fee2e2 !important; } 
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCvb5-ucESesD-wkDbXCunBOk1mcf-U-yQ",
            authDomain: "rentmanagerpro-f0bae.firebaseapp.com",
            projectId: "rentmanagerpro-f0bae",
            storageBucket: "rentmanagerpro-f0bae.firebasestorage.app",
            messagingSenderId: "1072854075313",
            appId: "1:1072854075313:web:229838dbb0c21426969f90",
            measurementId: "G-RL7S946QC2"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.login = async () => {
            const e = document.getElementById('email').value;
            const p = document.getElementById('pass').value;
            try { await signInWithEmailAndPassword(auth, e, p); } 
            catch { try { await createUserWithEmailAndPassword(auth, e, p); } catch(err) { alert("‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°!"); } }
        };

        onAuthStateChanged(auth, user => {
            if (user) {
                document.getElementById('auth-page').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                setupYearOptions(); // ‡¶¨‡¶õ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
            } else {
                document.getElementById('auth-page').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
            }
        });

        // ‡ß´‡ß¶ ‡¶¨‡¶õ‡¶∞‡ßá‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡¶õ‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function setupYearOptions() {
            const yearSelect = document.getElementById('year');
            const currentYear = new Date().getFullYear();
            yearSelect.innerHTML = ""; 
            for (let i = 0; i <= 50; i++) {
                const year = currentYear + i;
                const option = document.createElement('option');
                option.value = year;
                option.text = year;
                if (year === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }
        }

        window.logout = () => signOut(auth);

        let curYear, curMonth;
        window.startApp = () => {
            curYear = document.getElementById('year').value;
            document.getElementById('year-sec').classList.add('hidden');
            document.getElementById('month-sec').classList.remove('hidden');
        };

        window.openMonth = (m) => {
            curMonth = m;
            document.getElementById('month-sec').classList.add('hidden');
            document.getElementById('due-summary-sec').classList.add('hidden');
            document.getElementById('table-sec').classList.remove('hidden');
            document.getElementById('title').innerText = `${m} - ${curYear}`;
            loadData();
        };

        window.addRoom = () => {
            const tbody = document.getElementById('rows');
            const tr = document.createElement('tr');
            tr.className = "status-due"; 
            tr.innerHTML = `
                <td class="border p-2"><input type="text" placeholder="‡¶∞‡ßÅ‡¶Æ ‡¶®‡¶Ç" class="w-full border rounded room"></td>
                <td class="border p-2"><input type="text" placeholder="‡¶®‡¶æ‡¶Æ" class="w-full border rounded name"></td>
                <td class="border p-2"><input type="tel" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤" class="w-full border rounded mobile"></td>
                <td class="border p-2"><input type="date" class="w-full border rounded date"></td>
                <td class="border p-2"><input type="number" placeholder="‡¶≠‡¶æ‡ßú‡¶æ" oninput="calc(this)" class="w-full border rounded rent"></td>
                <td class="border p-2"><input type="number" placeholder="‡¶ú‡¶Æ‡¶æ" oninput="calc(this)" class="w-full border rounded rec"></td>
                <td class="border p-2"><input type="number" readonly class="w-full bg-gray-100 rounded due font-bold text-red-600"></td>
                <td class="border p-2 text-center"><button onclick="send(this)" class="send-btn bg-green-600 text-white w-full rounded font-bold">SMS</button></td>
            `;
            tbody.appendChild(tr);
        };

        window.calc = (el) => {
            const row = el.closest('tr');
            const rent = parseFloat(row.querySelector('.rent').value) || 0;
            const rec = parseFloat(row.querySelector('.rec').value) || 0;
            const due = rent - rec;
            row.querySelector('.due').value = due;

            row.classList.remove('status-full', 'status-partial', 'status-due');
            if (rent > 0 && due <= 0) row.classList.add('status-full');
            else if (rec > 0 && due > 0) row.classList.add('status-partial');
            else row.classList.add('status-due');
        };

        window.send = (btn) => {
            const r = btn.closest('tr');
            const msg = `‡¶∞‡ßÅ‡¶Æ: ${r.querySelector('.room').value}, ‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ: ${r.querySelector('.name').value}, ‡¶Æ‡¶æ‡¶∏: ${curMonth}, ‡¶≠‡¶æ‡ßú‡¶æ: ${r.querySelector('.rent').value}, ‡¶ú‡¶Æ‡¶æ: ${r.querySelector('.rec').value}, ‡¶¨‡¶ï‡ßá‡ßü‡¶æ: ${r.querySelector('.due').value}‡•§ ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§ - Created by Akash Sheikh`;
            window.location.href = `sms:${r.querySelector('.mobile').value}?body=${encodeURIComponent(msg)}`;
        };

        window.saveData = async () => {
            const btn = document.getElementById('saveBtn');
            btn.innerText = "‡¶∏‡ßá‡¶≠‡¶ø‡¶Ç...";
            const rows = [];
            document.querySelectorAll('#rows tr').forEach(tr => {
                rows.push({
                    room: tr.querySelector('.room').value,
                    name: tr.querySelector('.name').value,
                    mobile: tr.querySelector('.mobile').value,
                    date: tr.querySelector('.date').value,
                    rent: tr.querySelector('.rent').value,
                    rec: tr.querySelector('.rec').value,
                    due: tr.querySelector('.due').value
                });
            });
            const id = `${auth.currentUser.uid}_${curYear}_${curMonth}`;
            await setDoc(doc(db, "data", id), { rows, month: curMonth, year: curYear });
            btn.innerText = "‡¶∏‡ßá‡¶≠ (Cloud)";
            alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        };

        async function loadData() {
            const id = `${auth.currentUser.uid}_${curYear}_${curMonth}`;
            const snap = await getDoc(doc(db, "data", id));
            const tbody = document.getElementById('rows');
            tbody.innerHTML = "";
            if(snap.exists()) {
                snap.data().rows.forEach(d => {
                    const tr = document.createElement('tr');
                    const dueVal = parseFloat(d.due) || 0;
                    const rentVal = parseFloat(d.rent) || 0;
                    const recVal = parseFloat(d.rec) || 0;
                    if (rentVal > 0 && dueVal <= 0) tr.className = "status-full";
                    else if (recVal > 0 && dueVal > 0) tr.className = "status-partial";
                    else tr.className = "status-due";

                    tr.innerHTML = `
                        <td class="border p-2"><input type="text" class="w-full border rounded room" value="${d.room}"></td>
                        <td class="border p-2"><input type="text" class="w-full border rounded name" value="${d.name}"></td>
                        <td class="border p-2"><input type="tel" class="w-full border rounded mobile" value="${d.mobile}"></td>
                        <td class="border p-2"><input type="date" class="w-full border rounded date" value="${d.date}"></td>
                        <td class="border p-2"><input type="number" oninput="calc(this)" class="w-full border rounded rent" value="${d.rent}"></td>
                        <td class="border p-2"><input type="number" oninput="calc(this)" class="w-full border rounded rec" value="${d.rec}"></td>
                        <td class="border p-2"><input type="number" readonly class="w-full bg-gray-100 rounded due font-bold text-red-600" value="${d.due}"></td>
                        <td class="border p-2 text-center"><button onclick="send(this)" class="send-btn bg-green-600 text-white w-full rounded font-bold">SMS</button></td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        }

        window.showDueSummary = async () => {
            document.getElementById('month-sec').classList.add('hidden');
            document.getElementById('table-sec').classList.add('hidden');
            document.getElementById('due-summary-sec').classList.remove('hidden');
            const dueList = document.getElementById('due-list');
            dueList.innerHTML = "‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            const querySnapshot = await getDocs(collection(db, "data"));
            dueList.innerHTML = "";
            querySnapshot.forEach((doc) => {
                if(doc.id.startsWith(auth.currentUser.uid)) {
                    const data = doc.data();
                    data.rows.forEach(row => {
                        if(parseFloat(row.due) > 0) {
                            const div = document.createElement('div');
                            div.className = "bg-white p-4 mb-2 rounded-lg shadow border-l-4 border-red-500 flex justify-between items-center";
                            div.innerHTML = `
                                <div>
                                    <p class="font-bold text-blue-800">‡¶∞‡ßÅ‡¶Æ: ${row.room} | ${row.name}</p>
                                    <p class="text-sm text-gray-600">‡¶Æ‡¶æ‡¶∏: ${data.month} ${data.year} | ‡¶¨‡¶ï‡ßá‡ßü‡¶æ: <span class="text-red-600 font-bold">${row.due} TK</span></p>
                                </div>
                                <button onclick="curYear='${data.year}'; openMonth('${data.month}')" class="bg-blue-100 text-blue-600 px-3 py-1 rounded text-sm font-bold">‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                            `;
                            dueList.appendChild(div);
                        }
                    });
                }
            });
            if(dueList.innerHTML === "") dueList.innerHTML = "<p class='text-center text-green-600 font-bold'>‡¶ï‡ßã‡¶® ‡¶¨‡¶ï‡ßá‡ßü‡¶æ ‡¶®‡ßá‡¶á! üòä</p>";
        };
    </script>
</head>
<body class="bg-blue-50 font-sans">
    <div id="auth-page" class="flex flex-col items-center justify-center min-h-screen p-4">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md border-t-8 border-blue-600">
            <h1 class="text-3xl font-extrabold mb-6 text-blue-700 text-center">‡¶∞‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã</h1>
            <p class="text-center text-gray-500 mb-6">‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶¨‡¶æ‡ßú‡¶ø‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶® ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶‡ßá</p>
            <input id="email" type="email" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤" class="w-full border-2 p-3 mb-4 rounded-xl focus:border-blue-500 outline-none">
            <input id="pass" type="password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°" class="w-full border-2 p-3 mb-6 rounded-xl focus:border-blue-500 outline-none">
            <button onclick="login()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-bold text-lg transition shadow-lg">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ / ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</button>
        </div>
        <p class="mt-6 text-gray-500 font-semibold italic">Developed by <span class="text-blue-600">Akash Sheikh</span></p>
    </div>

    <div id="main-app" class="hidden min-h-screen p-2 md:p-6">
        <div class="max-w-6xl mx-auto">
            <div class="flex justify-between items-center mb-6 bg-white p-4 rounded-xl shadow">
                <h2 class="text-xl font-bold text-blue-700">‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>
                <div class="flex gap-2">
                    <button onclick="showDueSummary()" class="bg-orange-500 text-white px-3 py-2 rounded-lg font-bold text-sm">‡¶¨‡¶ï‡ßá‡ßü‡¶æ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</button>
                    <button onclick="logout()" class="bg-red-100 text-red-600 px-3 py-2 rounded-lg font-bold text-sm">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
                </div>
            </div>

            <div id="due-summary-sec" class="hidden mb-6">
                <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-orange-500">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-700">‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                        <button onclick="document.getElementById('due-summary-sec').classList.add('hidden'); document.getElementById('month-sec').classList.remove('hidden');" class="text-blue-600 font-bold">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                    <div id="due-list" class="max-h-96 overflow-y-auto"></div>
                </div>
            </div>

            <div id="year-sec" class="text-center bg-white p-10 rounded-2xl shadow-lg">
                <h3 class="text-2xl font-bold mb-6 text-gray-700">‡¶¨‡¶õ‡¶∞ ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶®</h3>
                <select id="year" class="w-full max-w-xs p-4 border-2 border-blue-200 rounded-xl text-xl mb-8 focus:border-blue-500 outline-none">
                    </select><br>
                <button onclick="startApp()" class="bg-blue-600 text-white px-12 py-4 rounded-full text-xl font-bold shadow-lg hover:bg-blue-700 transition">‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>

            <div id="month-sec" class="hidden">
                <h3 class="text-center text-xl font-bold mb-6 text-gray-600">‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                    <script>
                        const m_list = ["‡¶ú‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø", "‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø", "‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö", "‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤", "‡¶Æ‡ßá", "‡¶ú‡ßÅ‡¶®", "‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á", "‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü", "‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞", "‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞", "‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞", "‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞"];
                        m_list.forEach(m => document.write(`
                            <button onclick="openMonth('${m}')" class="bg-white p-6 rounded-2xl shadow hover:shadow-md hover:bg-blue-50 transition border-b-4 border-blue-200 font-bold text-blue-700 text-lg">
                                ${m}
                            </button>
                        `));
                    </script>
                </div>
                <button onclick="location.reload()" class="mt-8 text-gray-500 font-bold block mx-auto underline">‡¶¨‡¶õ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>

            <div id="table-sec" class="hidden">
                <div class="bg-blue-600 text-white p-4 rounded-t-2xl flex justify-between items-center shadow-lg">
                    <h3 id="title" class="font-bold text-xl"></h3>
                    <button onclick="addRoom()" class="bg-white text-blue-600 px-4 py-2 rounded-lg font-bold shadow">+ ‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡ßÅ‡¶Æ</button>
                </div>
                
                <div class="overflow-x-auto bg-white shadow-xl rounded-b-2xl mb-6">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-gray-100 text-gray-600 text-sm uppercase">
                            <tr>
                                <th class="p-4 border">‡¶∞‡ßÅ‡¶Æ ‡¶®‡¶Ç</th>
                                <th class="p-4 border">‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</th>
                                <th class="p-4 border">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</th>
                                <th class="p-4 border">‡¶≠‡¶æ‡ßú‡¶æ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                <th class="p-4 border text-blue-600">‡¶Æ‡ßã‡¶ü ‡¶≠‡¶æ‡ßú‡¶æ</th>
                                <th class="p-4 border text-green-600">‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶¶‡¶æ‡ßü</th>
                                <th class="p-4 border text-red-600">‡¶¨‡¶ï‡ßá‡ßü‡¶æ</th>
                                <th class="p-4 border text-center">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                            </tr>
                        </thead>
                        <tbody id="rows" class="text-gray-700 font-medium"></tbody>
                    </table>
                </div>

                <div class="flex flex-wrap gap-4 justify-center pb-6">
                    <button id="saveBtn" onclick="saveData()" class="bg-green-600 hover:bg-green-700 text-white px-10 py-4 rounded-xl font-bold text-lg shadow-lg transition">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶® (Cloud)</button>
                    <button onclick="document.getElementById('table-sec').classList.add('hidden'); document.getElementById('month-sec').classList.remove('hidden');" class="bg-gray-500 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg">‡¶™‡¶ø‡¶õ‡¶®‡ßá ‡¶Ø‡¶æ‡¶®</button>
                </div>
            </div>

            <footer class="mt-10 pb-10 text-center">
                <p class="text-gray-400 text-sm italic">Rent Manager Pro Version 2.0</p>
                <p class="text-gray-600 font-bold">Created with ‚ù§Ô∏è by Akash Sheikh</p>
            </footer>
        </div>
    </div>
</body>
</html>
